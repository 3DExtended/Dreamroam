name: MacOS Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: macos-latest

    steps:
    - name: vulkan sdk
      run: mkdir -p ~/vulkan/VulkanSDK && cd ~/vulkan/ && sudo curl -o VulkanSDK.dmg https://sdk.lunarg.com/sdk/download/1.2.141.2/mac/vulkansdk-macos-1.2.141.2.dmg && cd VulkanSDK && sudo hdiutil attach ../VulkanSDK.dmg && cd /Volumes/VulkanSDK/ && ./install_vulkan.py --force-install 
    - uses: actions/checkout@v2
    - name: clone submodules
      run: git submodule update --recursive --init
    - name: cmake
      run: export VULKAN_SDK="~/vulkan/VulkanSDK/1.2.148.0/x86_64" && export PATH="${VULKAN_SDK}/bin:${PATH}" && export LD_LIBRARY_PATH="${VULKAN_SDK}/lib:${LD_LIBRARY_PATH}" && export VK_LAYER_PATH="${VULKAN_SDK}/etc/explicit_layer.d:${VK_LAYER_PATH}" &&  cmake . &&  cmake . 
    - name: make -j8
      run: export VULKAN_SDK="~/vulkan/VulkanSDK/1.2.148.0/x86_64" && export PATH="${VULKAN_SDK}/bin:${PATH}" && export LD_LIBRARY_PATH="${VULKAN_SDK}/lib:${LD_LIBRARY_PATH}" && export VK_LAYER_PATH="${VULKAN_SDK}/etc/explicit_layer.d:${VK_LAYER_PATH}" && make
